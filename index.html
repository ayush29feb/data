<!DOCTYPE html>
<html>
  <head>
    <title>Single View NeRF Metric Visualizations</title>
    <script src="https://cdn.jsdelivr.net/npm/vega@5.20.2"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.1.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.17.0"></script>
  </head>
  <body>
    <div id="bar"></div>
    <div id="percentile"></div>
    <div id="trellis"></div>
    <div id="heatmap"></div>

    <script type="text/javascript">
      var barSpec = {
        "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
        "data": {
          "url": "https://raw.githubusercontent.com/ayush29feb/data/master/vega-metrics/data2.json"
        },
        "transform": [
          {"fold": ["l1", "psnr", "lpips"]}
        ],
        "resolve":{
          "scale":{
            "y":"independent"
          }
        },
        "facet": {
          "row": {"field": "dataset"},
          "column": {"field": "key", "title": "Metric"},
        },
        "spec": {
          "mark": {"type": "bar", "tooltip": {"content": "data"}},
          "encoding": {
            "y": {"field": "value", "type": "quantitative", "title": null, "aggregate": "median"},
            "x": {"field": "method", "type": "nominal"},
            "color": {"field": "method", "type": "nominal"}
          }
        }
      };
      var percentileSpec = {
        "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
        "data": {
          "url": "https://raw.githubusercontent.com/ayush29feb/data/master/vega-metrics/data2.json"
        },
        "transform": [
          {"fold": ["l1", "psnr", "lpips"]},
          {
            "window": [{
              "op": "count",
              "field": "value",
              "as": "count_value"
            }],
            "sort": [{"field": "value", "order": "ascending"}],
            "groupby": ["dataset", "key", "method"],
            "ignorePeers": false,
            "frame": [null, 0]
          }
        ],
        "resolve":{
          "scale":{
            "y":"independent"
          }
        },
        "facet": {
          "row": {"field": "dataset"},
          "column": {"field": "key", "title": "Metric"}
        },
        "spec": {
          "mark": {"type": "line", "tooltip": {"content": "data"}},
          "encoding": {
            "color": {"field": "method", "type": "nominal"},
            "y": {"field": "value", "type": "quantitative", "title": null},
            "x": {"field": "count_value", "type": "quantitative", "title": "#samples"}
          }
        }
      };
      var heatmapSpec = {
        "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
        "data": { "url": "https://raw.githubusercontent.com/ayush29feb/data/master/vega-metrics/data2.json"},
        "transform": [
          {"fold": ["l1", "psnr", "lpips"]}
        ],
        "facet": {
          "column": {
            "field": "key",
            "type": "nominal",
            "title": "Metric"
          },
          "row": {
            "field": "dataset",
            "type": "nominal"
          }
        },
        "resolve":{
          "scale":{
            "color":"independent"
          }
        },
        "spec": {
          "mark": {"type": "rect", "tooltip": {"content": "data"}},
          "encoding": {
            "x": {"field": "method", "type":"nominal"},
            "color": {"field": "value", "type": "quantitative", "scale": {}},
            "y": {"field": "pair", "type": "ordinal"}
          }
        }
      };

      var trellisSpec = {
        "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
        "data": { "url": "https://raw.githubusercontent.com/ayush29feb/data/master/vega-metrics/data2.json"},
        "transform": [
          {"fold": ["l1", "psnr", "lpips"]}
        ],
        "facet": {
          "column": {
            "field": "key",
            "type": "nominal",
            "title": "Metric"
          },
          "row": {
            "field": "dataset",
            "type": "nominal"
          }
        },
        "resolve":{
          "scale":{
            "x": "independent"
          }
        },
        "spec": {
          "mark": {"type": "circle", "tooltip": {"content": "data"}},
          "encoding": {
            "color": {"field": "method", "type":"nominal"},
            "x": {"field": "value", "type": "quantitative", "scale": {}},
            "y": {"field": "pair", "type": "ordinal"}
          }
        }
      };
      vegaEmbed('#bar', barSpec);
      vegaEmbed('#percentile', percentileSpec);
      vegaEmbed('#trellis', trellisSpec);
      // vegaEmbed('#heatmap', heatmapSpec);
    </script>
  </body>
</html>
